<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>K-Pop Discovery — Prototype</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1115; --card-bg:rgba(255,255,255,0.04);
    --accent:#1DB954; --muted:rgba(255,255,255,0.6);
    font-family:Inter,system-ui,Segoe UI,Arial;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;overflow:hidden}
  .app{height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:18px}
  .header{width:100%;max-width:420px;display:flex;align-items:center;justify-content:space-between}
  .pill{background:#111214;padding:8px 12px;border-radius:999px;font-weight:700}
  .filters{width:100%;max-width:420px;background:transparent;display:flex;gap:8px;flex-wrap:wrap}
  /* CHIP: unselected = black bg + white text, selected = spotify green + dark text */
  .chip{
    background:#000;color:#fff;padding:8px 10px;border-radius:999px;cursor:pointer;font-size:13px;border:1px solid rgba(255,255,255,0.04);
    display:inline-flex;align-items:center;gap:8px;
  }
  .chip .count{background:rgba(255,255,255,0.06);padding:2px 6px;border-radius:999px;margin-left:8px;font-weight:700;font-size:11px}
  .chip.active{background:var(--accent);color:#041;box-shadow:0 6px 20px rgba(27,185,84,0.12)}
  .feed{width:100%;max-width:420px;height:68vh;position:relative;overflow:hidden;border-radius:14px}
  .card{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;padding:18px;transition:transform .28s cubic-bezier(.2,.9,.2,1),opacity .28s;backdrop-filter: blur(6px)}
  .card.hidden{opacity:0;transform:translateY(20px) scale(.99);pointer-events:none}
  .card .meta{width:100%;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .artwrap{width:100%;height:54%;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;margin-bottom:12px;background:#000}
  .artwrap iframe{width:100%;height:100%;border:0}
  .artist{display:flex;align-items:center;gap:12px}
  .artist img{width:44px;height:44px;border-radius:999px;object-fit:cover;border:2px solid rgba(255,255,255,0.06)}
  .title{font-weight:700}
  .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .tag{background:rgba(255,255,255,0.06);padding:6px 8px;border-radius:999px;font-size:12px;color:#fff}
  .actions{display:flex;gap:8px;align-items:center}
  .btn{background:rgba(255,255,255,0.06);border:0;padding:8px 10px;border-radius:10px;cursor:pointer;color:#fff}
  .heart{width:36px;height:36px;border-radius:9px;display:grid;place-items:center;transition:transform .18s}
  .heart.saved{background:linear-gradient(135deg,#ff6b8a,#ff9a9a);color:#111}
  .counter{position:absolute;left:12px;top:12px;background:rgba(0,0,0,0.28);padding:6px 10px;border-radius:999px;font-weight:700}
  .dots{position:absolute;right:12px;top:12px;display:flex;flex-direction:column;gap:8px}
  .dot{width:8px;height:8px;border-radius:99px;background:rgba(255,255,255,0.15);cursor:pointer}
  .dot.active{transform:scale(1.6);background:var(--accent)}
  .saved-anim{position:absolute;right:18px;bottom:18px;animation:pop .9s ease-out;pointer-events:none}
  @keyframes pop{0%{transform:scale(.6);opacity:0}40%{transform:scale(1.15);opacity:1}100%{transform:scale(1);opacity:1}}
  /* small */
  @media (max-width:520px){
    .app{padding:12px}
    .feed{height:72vh}
  }
</style>
</head>
<body>
<div class="app" id="app">
  <div class="header">
    <div class="pill">K-Pop Discovery</div>
    <div style="color:var(--muted);font-size:13px">Demo • Swipe vertically</div>
  </div>

  <div class="filters" id="filters">
    <!-- dynamic chips -->
  </div>

  <div class="feed" id="feed" aria-live="polite">
    <div class="counter" id="counter">0 / 0</div>
    <div class="dots" id="dots"></div>

    <!-- cards injected here -->
  </div>

  <div style="width:100%;max-width:420px;display:flex;justify-content:space-between;margin-top:6px;color:var(--muted);font-size:13px">
    <div>Try filters + vertical swipe</div>
    <div>Prototype time saved: <strong style="color:var(--accent)">~ &lt;2 min</strong></div>
  </div>
</div>

<script>
/*
 Updated prototype data with your artist images and added tracks (ATEEZ, TWICE).
*/
const TRACKS = [
  {
    id: "1Zsy7gMUcHDhxC0bbyZmC2", // Monsta X — GAMBLER (demo)
    artist: "MONSTA X",
    track: "GAMBLER",
    era: "3rd Gen",
    concept: "dark",
    group: "boy",
    vibeColor: "#2b2a33",
    artistImg: "https://ucarecdn.com/bb9910a8-3f95-423d-9569-7ef722782726/-/format/auto/-/preview/3000x3000/-/quality/lighter/"
  },
  {
    id: "4XPXrcpyNr30Km6aPiflJy", // Stray Kids — God's Menu (demo)
    artist: "Stray Kids",
    track: "God's Menu",
    era: "4th Gen",
    concept: "performance",
    group: "boy",
    vibeColor: "#9b4dff",
    artistImg: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQedFFWom--wlGfFVTvLKq1Iw0B_wwJEcY2lg&s"
  },
  {
    id: "46E1ic6n099e76t5J1TbHn", // SHINee — View
    artist: "SHINee",
    track: "View",
    era: "2nd Gen",
    concept: "bright",
    group: "boy",
    vibeColor: "#1fb6ff",
    artistImg: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQujaNIZx7w5V5lscD4d5QsOWQaPDqoEsNijQ&s"
  },
  {
    id: "0ZeGfEAL5Rl4pd5LZBGuEK", // HWASA — Maria
    artist: "HWASA",
    track: "Maria",
    era: "3rd Gen",
    concept: "healing",
    group: "solo",
    vibeColor: "#ff8da1",
    artistImg: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTiGrUlNjFdLmd-kr9QJn30esQ3chvDlvIMIw&s"
  },
  {
    id: "3Z4BxvgOJ8KupcDIV3OV2f", // ATEEZ — In Your Fantasy (your link)
    artist: "ATEEZ",
    track: "In Your Fantasy",
    era: "4th Gen",
    concept: "performance",
    group: "boy",
    vibeColor: "#ffb86b",
    artistImg: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQAVogPwuLtA1wGxRVOA1GByXEVQUL-n_5sFw&s"
  },
  {
    id: "1Zr1SoGePJ3iKKakmmZaMR", // TWICE — SET ME FREE (your link)
    artist: "TWICE",
    track: "SET ME FREE",
    era: "3rd Gen",
    concept: "bright",
    group: "girl",
    vibeColor: "#ffd6e0",
    artistImg: "https://www.billboard.com/wp-content/uploads/2023/02/feature-TWICE-women-in-music-billboard-2023-bb2-sunhye-shin-2-1260.jpg?w=875&h=583&crop=1"
  }
];

const filtersSpec = {
  "Era": ["2nd Gen","3rd Gen","4th Gen"],
  // concepts reduced to the three you emphasized (plus performance for variety)
  "Concept": ["dark","bright","healing","performance"],
  "Group": ["boy","girl","solo","co-ed"]
};

let activeFilters = { Era: new Set(), Concept: new Set(), Group: new Set() };
let filtered = [...TRACKS];
let currentIndex = 0;

const feed = document.getElementById('feed');
const filtersEl = document.getElementById('filters');
const counterEl = document.getElementById('counter');
const dotsEl = document.getElementById('dots');

function createFilterChips(){
  filtersEl.innerHTML = '';
  for(const [group, arr] of Object.entries(filtersSpec)){
    const label = document.createElement('div');
    label.style.width='100%';
    label.style.display='flex';
    label.style.gap='8px';
    label.style.alignItems='center';
    label.style.flexWrap='wrap';
    const heading = document.createElement('div');
    heading.textContent = group + ':';
    heading.style.color = 'var(--muted)';
    heading.style.fontSize='12px';
    heading.style.marginRight='6px';
    label.appendChild(heading);

    arr.forEach(opt=>{
      const chip = document.createElement('button');
      chip.className='chip';
      chip.dataset.group = group;
      chip.dataset.opt = opt;
      // when unselected: black bg + white text (visible) as you requested
      chip.innerHTML = `${opt} <span class="count" style="display:none">0</span>`;
      chip.addEventListener('click',()=>toggleFilter(chip));
      label.appendChild(chip);
    });
    filtersEl.appendChild(label);
  }
  updateChipCounts();
}

function toggleFilter(chip){
  const group = chip.dataset.group;
  const opt = chip.dataset.opt;
  const set = activeFilters[group];
  if(set.has(opt)) set.delete(opt); else set.add(opt);
  chip.classList.toggle('active', set.has(opt));
  updateFiltered();
  updateChipCounts();
}

function updateChipCounts(){
  const chips = document.querySelectorAll('.chip');
  chips.forEach(c=>{
    const g = c.dataset.group, o = c.dataset.opt;
    const count = TRACKS.filter(t=> tMatchesFilter(t, {[g]: new Set([o])})).length;
    const badge = c.querySelector('.count');
    if(count>0){ badge.style.display='inline-block'; badge.textContent = count; } else { badge.style.display='none'; }
  });
}

function tMatchesFilter(item, filters){
  for(const [g,set] of Object.entries(filters)){
    if(set.size===0) continue;
    if(g==="Era"){ if(!set.has(item.era)) return false; }
    if(g==="Concept"){ if(!set.has(item.concept)) return false; }
    if(g==="Group"){ if(!set.has(item.group)) return false; }
  }
  return true;
}

function updateFiltered(){
  const active = {};
  for(const [k,v] of Object.entries(activeFilters)){
    active[k] = v;
  }
  filtered = TRACKS.filter(t=> tMatchesFilter(t, active));
  if(filtered.length===0){
    renderNoResults();
    return;
  }
  if(currentIndex >= filtered.length) currentIndex = 0;
  renderFeed();
}

function renderNoResults(){
  feed.innerHTML = `<div class="card" style="display:flex;align-items:center;justify-content:center"><div style="text-align:center;color:var(--muted)"><div style="font-size:18px;font-weight:700">No results</div><div style="margin-top:6px">Try toggling filters</div></div></div>`;
  counterEl.textContent = `0 / 0`;
  dotsEl.innerHTML = '';
}

function renderFeed(){
  feed.querySelectorAll('.card')?.forEach(n=>n.remove());
  dotsEl.innerHTML = '';

  filtered.forEach((t, idx)=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.style.background = `linear-gradient(180deg, ${hexAlpha(t.vibeColor,0.08)} 0%, rgba(0,0,0,0.28) 100%)`;
    card.style.zIndex = filtered.length - idx;
    if(idx !== currentIndex) card.classList.add('hidden');

    // art (Spotify embed)
    const artwrap = document.createElement('div');
    artwrap.className = 'artwrap';
    const iframe = document.createElement('iframe');
    iframe.src = `https://open.spotify.com/embed/track/${t.id}`;
    iframe.allow = "encrypted-media";
    artwrap.appendChild(iframe);

    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.innerHTML = `
      <div style="flex:1">
        <div class="artist">
          <img src="${t.artistImg}" alt="${t.artist}">
          <div>
            <div class="title">${escapeHtml(t.track)}</div>
            <div style="font-size:12px;color:var(--muted)">${escapeHtml(t.artist)}</div>
          </div>
        </div>
        <div class="tags">
          <div class="tag">${t.era}</div>
          <div class="tag">${t.concept}</div>
          <div class="tag">${t.group}</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
        <div class="actions">
          <button class="btn" title="Add to playlist">＋</button>
          <button class="btn" title="Follow">Follow</button>
          <button class="btn heart" title="Save">${heartSvg(false)}</button>
        </div>
      </div>
    `;
    card.appendChild(artwrap);
    card.appendChild(meta);
    feed.appendChild(card);

    // dot
    const dot = document.createElement('div');
    dot.className='dot';
    dot.title = `${t.track} — ${t.artist}`;
    if(idx===currentIndex) dot.classList.add('active');
    dot.addEventListener('click', ()=> { jumpTo(idx); });
    dotsEl.appendChild(dot);

    // quick action bindings
    const heartBtn = card.querySelector('.heart');
    heartBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const saved = heartBtn.classList.toggle('saved');
      heartBtn.innerHTML = heartSvg(saved);
      if(saved){ showSavedAnim(card, t.track); }
    });

    card.querySelector('button[title="Add to playlist"]').addEventListener('click', (ev)=>{
      ev.stopPropagation();
      flashMsg(card, 'Added to playlist');
    });
    card.querySelector('button[title="Follow"]').addEventListener('click', (ev)=>{
      ev.stopPropagation();
      flashMsg(card, 'Followed artist');
    });

  });

  updateUIControls();
}

function showSavedAnim(card, track){
  const el = document.createElement('div');
  el.className='saved-anim';
  el.style.color='#fff';
  el.innerHTML = `<div style="background:linear-gradient(135deg,#ff6b8a,#ff9a9a);padding:8px 10px;border-radius:10px;font-weight:700">Saved • ${escapeHtml(track)}</div>`;
  card.appendChild(el);
  setTimeout(()=>el.remove(), 1200);
}

function updateUIControls(){
  counterEl.textContent = `${currentIndex+1} / ${filtered.length}`;
  Array.from(dotsEl.children).forEach((d,i)=>d.classList.toggle('active', i===currentIndex));
}

/* Helpers for swipe navigation */
let startY = null;
let isTouch = false;
const threshold = 60;

function bindSwipe(){
  feed.addEventListener('touchstart', e=>{ isTouch=true; startY = e.touches[0].clientY; });
  feed.addEventListener('touchmove', e=>{ e.preventDefault(); });
  feed.addEventListener('touchend', e=>{
    if(startY===null) return;
    const endY = e.changedTouches[0].clientY;
    const diff = endY - startY;
    if(diff < -threshold) next(); else if(diff > threshold) prev();
    startY = null;
  }, {passive:false});

  let wheelCool = false;
  window.addEventListener('wheel', (e)=>{
    if(wheelCool) return;
    if(Math.abs(e.deltaY) < 10) return;
    wheelCool = true;
    if(e.deltaY > 0) next(); else prev();
    setTimeout(()=> wheelCool=false, 300);
  }, {passive:true});
}

function next(){
  const prevIndex = currentIndex;
  currentIndex = Math.min(filtered.length-1, currentIndex+1);
  animateSlide(prevIndex, currentIndex, -1);
}
function prev(){
  const prevIndex = currentIndex;
  currentIndex = Math.max(0, currentIndex-1);
  animateSlide(prevIndex, currentIndex, 1);
}

function jumpTo(idx){
  const prevIndex = currentIndex;
  currentIndex = idx;
  animateSlide(prevIndex, currentIndex, (idx>prevIndex)?-1:1);
}

function animateSlide(from, to, dir){
  const cards = Array.from(feed.querySelectorAll('.card'));
  cards.forEach((c,i)=>{
    if(i===to){
      c.classList.remove('hidden');
      c.style.transform = `translateY(${dir*18}px)`;
      c.style.opacity = 0;
      requestAnimationFrame(()=>{ c.style.transform = ''; c.style.opacity = 1; });
    } else if(i===from){
      c.style.transform = `translateY(${ -dir*22 }px)`;
      c.style.opacity = 0;
      setTimeout(()=> c.classList.add('hidden'), 260);
    } else {
      c.classList.add('hidden');
    }
  });
  updateUIControls();
}

/* tiny helpers */
function hexAlpha(hex, a){
  const c = hex.replace('#','');
  const r = parseInt(c.substring(0,2),16);
  const g = parseInt(c.substring(2,4),16);
  const b = parseInt(c.substring(4,6),16);
  return `rgba(${r},${g},${b},${a})`;
}
function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;'); }
function flashMsg(card, txt){
  const el = document.createElement('div');
  el.style.position='absolute'; el.style.left='18px'; el.style.bottom='18px'; el.style.background='rgba(0,0,0,0.5)';
  el.style.padding='8px 12px'; el.style.borderRadius='8px'; el.style.fontWeight='700';
  el.textContent = txt;
  card.appendChild(el);
  setTimeout(()=>el.remove(),900);
}
function heartSvg(saved){
  if(saved) return `❤️`;
  return `♡`;
}

/* init */
createFilterChips();
updateFiltered();
bindSwipe();

/* accessibility: keyboard up/down */
window.addEventListener('keydown', (e)=>{
  if(e.key==='ArrowDown') next();
  if(e.key==='ArrowUp') prev();
});
</script>
</body>
</html>


